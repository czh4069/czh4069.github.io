<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>象棋小游戏</title>
<style>
body {
  font-family: "Microsoft YaHei", sans-serif;
  margin: 0; padding: 0;
  background: #f5f5f5;
  text-align: center;
}
h2,h3 { margin-top: 20px; }
input, select {
  padding: 8px 10px;
  margin: 6px;
  font-size: 16px;
  border-radius: 8px;
  border: 1px solid #ccc;
}
#config section { margin-top: 60px; }

/* Material You 按钮风格 */
.btn {
  display: inline-block;
  padding: 12px 26px;
  margin: 10px;
  font-size: 16px;
  font-weight: 600;
  border: none;
  border-radius: 28px;
  background-color: #6750a4;
  color: #fff;
  box-shadow: 0 2px 5px rgba(0,0,0,0.25);
  cursor: pointer;
  transition: background-color .2s, box-shadow .2s;
}
.btn:hover { background-color: #7f67be; box-shadow: 0 4px 8px rgba(0,0,0,0.3);}
.btn:active { background-color: #4f378b; }

.btn-secondary {
  background: #ffffff;
  color: #6750a4;
  border: 2px solid #6750a4;
}
.btn-secondary:hover { background-color: #f3e8ff; }
.btn-secondary:active { background-color: #e9ddff; }

#board {
  margin: 20px auto;
  width: 540px;
  height: 600px;
  display: grid;
  grid-template-columns: repeat(9, 60px);
  grid-template-rows: repeat(10, 60px);
  background-color: #fce5cd;
  border: 3px solid #333;
}
.cell {
  border: 1px solid #aaa;
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  font-size: 20px;
}
.piece {
  width: 48px; height: 48px;
  border-radius: 50%;
  line-height: 48px;
  background: #fff;
  border: 2px solid #000;
}
#info { margin: 10px; font-size: 18px; }
#rules {
  display: none;
  border: 1px solid #aaa;
  background: #fff8dc;
  width: 70%;
  margin: 10px auto;
  padding: 10px;
  text-align: left;
}
</style>
</head>
<body>

<!-- 多步骤配置 -->
<div id="config">
  <!-- 步骤1 -->
  <section id="step1">
    <h3>第 1 步：请选择游戏人数</h3>
    <label><input type="radio" name="players" value="1"> 1 人（对战 AI）</label><br>
    <label><input type="radio" name="players" value="2" checked> 2 人（轮流）</label><br>
    <button class="btn" id="toStep2">下一步</button>
  </section>

  <!-- 步骤2 -->
  <section id="step2" style="display:none;">
    <h3>第 2 步：玩家1 名称与喜欢的颜色</h3>
    <input type="text" id="p1name" placeholder="玩家1姓名"><br>
    <input type="color" id="p1color" value="#ffcccc"><br>
    <button class="btn-secondary" id="backTo1">上一步</button>
    <button class="btn" id="toStep3">下一步</button>
  </section>

  <!-- 步骤3 -->
  <section id="step3" style="display:none;">
    <h3>第 3 步：玩家2 名称与喜欢的颜色</h3>
    <input type="text" id="p2name" placeholder="玩家2姓名"><br>
    <input type="color" id="p2color" value="#ccffff"><br>
    <button class="btn-secondary" id="backTo2">上一步</button>
    <button class="btn" id="toStep4">下一步</button>
  </section>

  <!-- 步骤4 -->
  <section id="step4" style="display:none;">
    <h3>第 4 步：确认配置</h3>
    <div id="summary"></div>
    <button class="btn-secondary" id="backTo3">上一步</button>
    <button class="btn" id="enterGame">进入游戏主页</button>
  </section>
</div>

<!-- 游戏主页 -->
<div id="gameArea" style="display:none;">
  <h2>象棋小游戏</h2>
  <button class="btn" id="startBtn">开始游戏</button>
  <button class="btn-secondary" id="rulesBtn">游戏玩法</button>
  <div id="rules">
    <h4>玩法简介</h4>
    <ul>
      <li>红方先行，轮流走棋。</li>
      <li>将帅对面不能直接相望。</li>
      <li>吃掉对方“将”或“帅”即胜。</li>
      <li>单人模式中 AI 会自动应对。</li>
    </ul>
  </div>
  <div id="info"></div>
  <div id="board"></div>
</div>

<script>
let playerCount=2;
let p1={name:"",color:"#ffcccc"};
let p2={name:"",color:"#ccffff"};
let board=[],currentSide='r',selected=null,highlights=[],gameStarted=false;

// ==== 多页面配置逻辑 ====
document.getElementById('toStep2').onclick=()=>{
  document.getElementById('step1').style.display='none';
  document.getElementById('step2').style.display='block';
};
document.getElementById('backTo1').onclick=()=>{
  document.getElementById('step2').style.display='none';
  document.getElementById('step1').style.display='block';
};
document.getElementById('toStep3').onclick=()=>{
  document.getElementById('step2').style.display='none';
  document.getElementById('step3').style.display='block';
};
document.getElementById('backTo2').onclick=()=>{
  document.getElementById('step3').style.display='none';
  document.getElementById('step2').style.display='block';
};
document.getElementById('toStep4').onclick=()=>{
  const pc=parseInt(document.querySelector('input[name="players"]:checked').value);
  const p1n=document.getElementById('p1name').value||'玩家1';
  const p2n=document.getElementById('p2name').value||(pc==1?'AI':'玩家2');
  p1={name:p1n,color:document.getElementById('p1color').value};
  p2={name:p2n,color:document.getElementById('p2color').value};
  playerCount=pc;
  document.getElementById('summary').innerHTML=
  `<p>人数：${pc}人</p>
   <p>玩家1：${p1n} 颜色：<span style="background:${p1.color};display:inline-block;width:20px;height:12px;border:1px solid #333"></span></p>
   <p>玩家2：${p2n} 颜色：<span style="background:${p2.color};display:inline-block;width:20px;height:12px;border:1px solid #333"></span></p>`;
  document.getElementById('step3').style.display='none';
  document.getElementById('step4').style.display='block';
};
document.getElementById('backTo3').onclick=()=>{
  document.getElementById('step4').style.display='none';
  document.getElementById('step3').style.display='block';
};
document.getElementById('enterGame').onclick=()=>{
  document.getElementById('config').style.display='none';
  document.getElementById('gameArea').style.display='block';
  initBoard(); renderBoard();
};

// ==== 游戏逻辑（简版完整象棋）====
const PIECES = {
  r:[["车","马","相","仕","帅","仕","相","马","车"],
     ["","","","","","","","",""],
     ["","炮","","","","","炮","",""],
     ["兵","","兵","","兵","","兵","","兵"]],
  b:[["车","马","象","士","将","士","象","马","车"],
     ["","","","","","","","",""],
     ["","炮","","","","","炮","",""],
     ["卒","","卒","","卒","","卒","","卒"]]
};
function initBoard(){
  board=[];
  for(let i=0;i<10;i++) board.push(Array(9).fill(""));
  for(let r=0;r<4;r++)
    for(let c=0;c<9;c++)
      if(PIECES.r[r][c]) board[r][c]="r_"+PIECES.r[r][c];
  for(let r=0;r<4;r++)
    for(let c=0;c<9;c++)
      if(PIECES.b[r][c]) board[9-r][8-c]="b_"+PIECES.b[r][c];
  currentSide='r'; selected=null; gameStarted=false;
}
function renderBoard(){
  const bd=document.getElementById('board');
  bd.innerHTML="";
  for(let i=0;i<10;i++) for(let j=0;j<9;j++){
    const cell=document.createElement('div');
    cell.className='cell';
    cell.dataset.x=j; cell.dataset.y=i;
    const p=board[i][j];
    if(p){
      const div=document.createElement('div');
      div.className='piece';
      div.textContent=p.slice(2);
      div.style.color=p[0]==='r'?'red':'black';
      cell.appendChild(div);
    }
    cell.onclick=()=>clickCell(i,j);
    bd.appendChild(cell);
  }
}
function clickCell(y,x){
  if(!gameStarted)return;
  const curSide=currentSide;
  const piece=board[y][x];
  if(piece && piece[0]==curSide){ selected={x,y}; return; }
  if(selected){
    movePiece(selected.x,selected.y,x,y);
    selected=null;
  }
}
function movePiece(x1,y1,x2,y2){
  const p=board[y1][x1];
  if(!p)return;
  // 简化：不验证合法性，直接移动并判定吃将
  const target=board[y2][x2];
  if(target && target[0]!==p[0]){
    if(target.endsWith("将")||target.endsWith("帅")){
      alert((p[0]==='r'?p1.name:p2.name)+" 获胜！");
      location.reload(); return;
    }
  }
  board[y2][x2]=p; board[y1][x1]="";
  currentSide=currentSide==='r'?'b':'r';
  document.body.style.backgroundColor=currentSide==='r'?p1.color:p2.color;
  renderBoard();
  if(playerCount===1 && currentSide==='b') setTimeout(aiMove,600);
}
function aiMove(){
  let moves=[];
  for(let y=0;y<10;y++)for(let x=0;x<9;x++){
    if(board[y][x] && board[y][x][0]==='b'){
      for(let yy=0;yy<10;yy++)for(let xx=0;xx<9;xx++){
        if(!board[yy][xx] || board[yy][xx][0]==='r')
          moves.push({x1:x,y1:y,x2:xx,y2:yy});
      }
    }
  }
  if(moves.length){
    const m=moves[Math.floor(Math.random()*moves.length)];
    movePiece(m.x1,m.y1,m.x2,m.y2);
  }
}
document.getElementById('startBtn').onclick=()=>{
  gameStarted=true;
  document.body.style.backgroundColor=p1.color;
  document.getElementById('info').textContent=p1.name+" 先手";
};
document.getElementById('rulesBtn').onclick=()=>{
  const r=document.getElementById('rules');
  r.style.display=r.style.display==='none'?'block':'none';
};
</script>
</body>
</html>